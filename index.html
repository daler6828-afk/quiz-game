<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Quiz Game</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
    font-family: Arial;
    background: #1e1e2f;
    color: white;
    text-align: center;
}
button {
    padding: 10px 20px;
    font-size: 18px;
    margin: 5px;
}
input {
    padding: 10px;
    font-size: 16px;
}
.card {
    background: #2e2e4f;
    padding: 20px;
    margin: 20px auto;
    max-width: 400px;
    border-radius: 10px;
}
</style>
</head>

<body>

<h1>üéÆ Quiz Game</h1>

<div class="card">
    <input id="name" placeholder="–¢–≤–æ—ë –∏–º—è"><br><br>
    <input id="room" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã"><br><br>
    <button onclick="join()">–í–æ–π—Ç–∏</button>
</div>

<div class="card" id="game" style="display:none;">
    <h2 id="question"></h2>
    <div id="answers"></div>
</div>

<div class="card">
    <h2>üèÜ –õ–∏–¥–µ—Ä—ã</h2>
    <div id="leaders"></div>
</div>

<script>
const firebaseConfig = {
    apiKey: "–í–°–¢–ê–í–¨_–°–Æ–î–ê",
    authDomain: "–í–°–¢–ê–í–¨_–°–Æ–î–ê",
    databaseURL: "–í–°–¢–ê–í–¨_–°–Æ–î–ê",
    projectId: "–í–°–¢–ê–í–¨_–°–Æ–î–ê",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let playerName, roomCode;
let score = 0;

const questions = [
    {
        q: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?",
        a: ["3", "4", "5"],
        c: 1
    },
    {
        q: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?",
        a: ["–ë–µ—Ä–ª–∏–Ω", "–ü–∞—Ä–∏–∂", "–†–∏–º"],
        c: 1
    }
];

let qIndex = 0;

function join() {
    playerName = name.value;
    roomCode = room.value;

    db.ref(`rooms/${roomCode}/players/${playerName}`).set({
        score: 0
    });

    game.style.display = "block";
    loadQuestion();
    listenLeaders();
}

function loadQuestion() {
    let q = questions[qIndex];
    question.innerText = q.q;
    answers.innerHTML = "";

    q.a.forEach((text, i) => {
        let btn = document.createElement("button");
        btn.innerText = text;
        btn.onclick = () => answer(i);
        answers.appendChild(btn);
    });
}

function answer(i) {
    if (i === questions[qIndex].c) score += 100;

    db.ref(`rooms/${roomCode}/players/${playerName}`).update({
        score
    });

    qIndex++;
    if (qIndex < questions.length) loadQuestion();
    else question.innerText = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!";
}

function listenLeaders() {
    db.ref(`rooms/${roomCode}/players`).on("value", snap => {
        leaders.innerHTML = "";
        let players = snap.val();
        let arr = Object.entries(players).sort((a,b)=>b[1].score-a[1].score);
        arr.forEach(p => {
            leaders.innerHTML += `<div>${p[0]} ‚Äî ${p[1].score}</div>`;
        });
    });
}
</script>

</body>
</html>